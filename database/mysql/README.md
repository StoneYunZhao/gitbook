# MySQL

* [SQL 语法](sql.md)
* [架构](architecture.md)
* [日志](log.md)
* [事务](transaction.md)
* [索引](indexing.md)
* [锁](lock.md)

## 范式设计

在设计关系型数据库模型的时候，需要对关系内部各个属性之间联系的合理化程度进行定义，即有不同等级的规范要求，这些规范要求叫做范式（NF）。可以理解为，一张数据表的设计需要满足某种设计标准的级别。

目前有 6 种范式，从低到高：1NF、2NF、3NF、BCNF、4NF、5NF。范式越高阶，冗余度越低，同时高阶范式一定符合低阶范式的要求。

### 键的种类

为了说明键的种类，我们用两张表作为例子：

```text
球员表：球员编号、姓名、身份证号、年龄、球队编号
球队表：球队编号、主教练、球队所在地
```

* **超键**：能唯一表示元组的属性集叫做超键。对于球员表来说。超键就是包含球员编号或身份证的任意属性组合。如（球员编号）、（球员编号，姓名）、（身份证号，年龄）等。
* **候选键**：不包含多余属性的超键。即最小的超键，对于球员表来说，就是（球员编号）或（身份证号）。
* **主键**：可以从候选键中选择一个作为主键。自己选定，比如（球员编号）。
* **外键**：如果数据表 R1 中的某属性集不是 R1 的主键，而是另一个数据表 R2 的主键，那么这个属性集就是数据表 R1 的外键。如球员表中的球队编号。
* **主属性**：包含在任意候选键中的属性称为主属性。在球员表中，主属性是（球员编号）、（身份证号）。
* **非主属性**：不包含在任意候选键中的属性。在球员表中，非主属性是（姓名）、（年龄）、（球队编号）。

### 1NF

### 2NF

### 3NF

## 基本使用

安装

```bash
# 仅安装客户端
yum install mysql
brew install mysql

# 仅安装服务端
yum install mysql-server
```

Docker 启动

```bash
docker pull mysql:8.0.16

docker run -d --name mysql \
-p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=123qwe \
-v /Users/zhaoyun/Downloads/mysql:/var/lib/mysql \
mysql:8.0.16
```

基本命令

```bash
# 连接 MySQL
mysql -u {username} -p {password} \
    -h {remote server ip or name} -P {port} \
    -D {DB name}
    
mysql -u pcopadm -h 127.0.0.1 -P 3306 -p
```

## 调优

数据库调优的目的是让数据库运行更快，响应时间更短，吞吐量更大。

但是怎么反馈快呢？一般可从如下几点：

* 用户反馈
* 日志分析
* 服务器资源监控
* 数据库内部监控

数据库调优的思路一般有如下几个步骤：

* 选择合适的 DBMS
* 优化表设计
  * 尽量遵循三范式
  * 若分析查询较多，尤其是联表查询，可采用反范式，即空间换时间
  * 选择合适数据类型。数值型优于字符型；字符型长度尽量短；字符型若长度确定用 CHAR
* 优化逻辑查询，即通过改变 SQL 内容让 SQL 执行效率更高
* 优化物理查询，比如高效地建立索引与合理地使用索引
* 使用缓存
* 库优化，如控制表数量、主从、分库分表

