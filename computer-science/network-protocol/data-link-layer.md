# Data Link Layer

**数据链路层**（Data Link Layer）是 OSI 参考模型第二层。还可以细分成介质访问控制（MAC）子层和逻辑链路控制（LLC）子层。

介质访问控制（**M**edium **A**ccess **C**ontrol，**MAC**）子层专职处理介质访问的争用与冲突问题。是数据链路层的下层部分。

在物理层提到 Hub，它是把信号复制发送给所有的接口，所以需要解决以下三个问题：

* 谁应该接受这个数据包？
* 多台机器同时发，冲突怎么解决？即**多路访问**问题。
* 如果发送错误怎么解决？

解决多路访问问题的方式：

* 信道划分。
* 轮流协议。
* 随机接入协议，比如以太网。

![&#x7B2C;&#x4E8C;&#x5C42;&#x7F51;&#x7EDC;&#x5305;&#x683C;&#x5F0F;](../../.gitbook/assets/image%20%2827%29.png)

解决第一个问题就要靠网络包的目标 MAC 地址。

解决第三个问题靠网络包的 CRC，**循环冗余校验**（**Cyclic redundancy check**）。

## ARP

**地址解析协议**（**A**ddress **R**esolution **P**rotocol，缩写：**ARP**）是一个通过解析网络层地址来找寻数据链路层地址的网络传输协议，即通过 IP 地址找 MAC 地址。

通过发送一个广播，谁的 IP 符合条件，谁叫回复自己的 MAC 地址。

![](../../.gitbook/assets/image%20%2816%29.png)

为了避免每次都用 ARP 请求，机器本地也会进行 ARP 缓存。当然机器会不断地上线下线，IP 也可能会变，所以 ARP 的 MAC 地址缓存过一段时间就会过期。

## 交换机

是二层设备。

一台 MAC1 电脑将一个包发送给另一台 MAC2 电脑，当这个包到达交换机的时候，一开始交换机也不知道MAC2 的电脑在哪个口，它只能将包转发给除了来的那个口之外的其他所有的口。但是，这个时候，交换机会会记住 MAC1 是来自一个明确的口。以后有包的目的地址是 MAC1 的，直接发送到这个口就可以了。

当交换机作为一个关卡一样，过了一段时间之后，就有了整个网络的一个结构了，这个时候，基本上不用广播了，全部可以准确转发。当然，每个机器的 IP 地址会变，所在的口也会变，因而交换机上的学习的结果，我们称为**转发表**，是有一个过期时间的。

## 总结

* MAC 层是用来解决多路访问的堵车问题的；
* ARP 是通过吼的方式来寻找目标 MAC 地址的，吼完之后记住一段时间，这个叫作缓存；
* 交换机是有 MAC 地址学习能力的，学完了它就知道谁在哪儿了，不用广播了。

